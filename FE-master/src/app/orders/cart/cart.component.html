<div *ngIf="!isLoading && cart && cart.data.cartItems.length > 0" class="row mb-5">
  <form class="col-md-12">
      <div class="site-blocks-table">
          <table class="table">
              <thead>
                  <tr>
                      <th class="product-thumbnail">Ảnh</th>
                      <th class="product-name">Sản phẩm</th>
                      <th class="product-price">Giá</th>
                      <th class="product-quantity">Số lượng</th>
                      <th class="product-total">Thành tiền</th>
                      <th class="product-remove">Xoá khỏi giỏ hàng</th>
                  </tr>
              </thead>
              <tbody>
                  <tr *ngFor="let item of cartItemsWithDetails">
                      <td class="product-thumbnail">
                          <img [src]="item.image" alt="{{ item.productName }}" class="img-fluid">
                      </td>
                      <td class="product-name">
                          <h2 class="h5 text-black">{{ item.productName }}</h2>
                      </td>
                      <td>{{ item.price.toLocaleString('vi-VN') }} VND</td>
                      <td>
                          <div class="input-group mb-3 d-flex align-items-center quantity-container" style="max-width: 120px;">
                              <div class="input-group-prepend">
                                  <button 
                                      class="btn btn-outline-black decrease" 
                                      type="button" 
                                      (click)="decreaseQuantity(item)"
                                      [disabled]="(item.tempQuantity || item.quantity) <= 1">
                                      -
                                  </button>
                              </div>
                              <input type="text" 
                                     class="form-control text-center quantity-amount" 
                                     [value]="item.tempQuantity" 
                                     readonly>
                              <div class="input-group-append">
                                  <button 
                                      class="btn btn-outline-black increase" 
                                      type="button" 
                                      (click)="increaseQuantity(item)"
                                      [disabled]="(item.tempQuantity || item.quantity) >= 10">
                                      +
                                  </button>
                              </div>
                          </div>
                      </td>
                      <td>{{ (item.price * (item.tempQuantity || item.quantity)).toLocaleString('vi-VN') }} VND</td>
                      <td>
                          <button class="btn btn-black btn-sm" (click)="removeFromCart(item)">X</button>
                      </td>
                  </tr>
              </tbody>
          </table>
          <div class="col-md-12 mt-3 text-right">
            <button 
              class="btn btn-primary btn-lg" 
              (click)="proceedToCheckout()"
              [disabled]="cart.data.cartItems.length === 0"
            >
              Tiến Hành Thanh Toán
            </button>
          </div>
      </div>
  </form>

  <!-- Nút xác nhận thay đổi -->
  <div class="col-md-12" *ngIf="hasUnsavedChanges()">
    <button class="btn btn-primary" (click)="checkForUnsavedChanges()">
      Xác nhận thay đổi
    </button>
  </div>
</div>

<!-- Modal xác nhận -->
<div *ngIf="confirmAction.type" class="modal" style="display: block; background: rgba(0,0,0,0.5); position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;">
  <div class="modal-dialog" style="margin: 10% auto; background: white; padding: 20px; max-width: 500px;">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">
                  {{ confirmAction.type === 'update' ? 'Xác nhận thay đổi số lượng' : 'Xác nhận xóa sản phẩm' }}
              </h5>
          </div>
          <div class="modal-body">
              <ng-container *ngIf="confirmAction.type === 'update'">
                  <p>Bạn sắp thay đổi số lượng các sản phẩm sau:</p>
                  <ul>
                      <li *ngFor="let item of confirmAction.items">
                          {{ item.productName }}: {{ item.quantity }} → {{ item.tempQuantity }}
                      </li>
                  </ul>
                  <p>Bạn có chắc muốn thực hiện không?</p>
              </ng-container>

              <div class="modal-body">
                <ng-container *ngIf="confirmAction.type === 'remove'">
                  <p>Bạn có chắc muốn xóa sản phẩm {{ confirmAction.items[0].productName }} khỏi giỏ hàng?</p>
                </ng-container>
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="cancelConfirmation()">Hủy</button>
            <button type="button" class="btn btn-primary" (click)="confirmRemove()">
              Xóa sản phẩm
            </button>
          </div>
      </div>
  </div>
</div>